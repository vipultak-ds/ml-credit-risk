# ðŸŽ¯ UNIFIED ML PIPELINE CONFIGURATION

# ---------------------------------------------------------
# MODEL CONFIGURATION
# ---------------------------------------------------------
model:
  type: "random_forest"
  catalog: "workspace"
  schema: "ml_credit_risk"
  base_name: "credit_risk_model"

  # ðŸ”¥ NEW MODEL NAMING RULE
  naming:
    format: "{catalog}.{schema}.{base_name}_{model_type}"

# ---------------------------------------------------------
# EXPERIMENT TRACKING
# ---------------------------------------------------------
experiment:
  name: "/Shared/CreditRisk_ML_Experiments"
  artifact_path: "ml_model"
  run_name_prefix: "credit_risk"

# ---------------------------------------------------------
# REGISTRY BEHAVIOR CONTROL
# ---------------------------------------------------------
registry:
  mode: "always_register"

  duplicate_detection:
    enabled: true
    metrics_to_compare:
      - "test_accuracy"
      - "test_f1"
      - "test_roc_auc"
    tolerance: 0.001

  versioning:
    auto_increment: true
    track_experiment_id: true

  aliases:
    auto_assign_best: false
    staging: "Staging"
    production: "Production"
    best: "Best"

# ---------------------------------------------------------
# METRICS CONFIGURATION
# ---------------------------------------------------------
metrics:
  classification:
    primary_metric: "test_recall"
    direction: "maximize"

    tracked_metrics:
      - "test_accuracy"
      - "test_precision"
      - "test_recall"
      - "test_f1"
      - "test_roc_auc"
      - "train_accuracy"
      - "train_time"
      - "inference_time"

    threshold_metrics:
      test_f1: 0.50
      test_roc_auc: 0.50
      test_recall: 0.50

# ---------------------------------------------------------
# DATA CONFIGURATION
# ---------------------------------------------------------
data:
  input_table: "workspace.ml_credit_risk.credit_risk_data"
  preprocessed_table: "workspace.ml_credit_risk.credit_risk_preprocessed"
  features:
    - checking_balance
    - months_loan_duration
    - credit_history
    - purpose
    - amount
    - savings_balance
    - employment_duration
    - percent_of_income
    - years_at_residence
    - age
    - other_credit
    - housing
    - existing_loans_count
    - job
    - dependents
    - phone

  label: "default"

  split:
    test_size: 0.2
    validation_size: 0.1
    random_state: 42
    stratify: true

# ---------------------------------------------------------
# PREPROCESSING CONFIGURATION
# ---------------------------------------------------------
preprocessing:
  enabled: false
  output_table: "workspace.ml_credit_risk.credit_risk_preprocessed"

  pipeline_models:
    onehot_model: "/Volumes/workspace/ml_credit_risk/ml_artifacts/preprocessing_pipeline/onehot_pipeline"
    scaler_model: "/Volumes/workspace/ml_credit_risk/ml_artifacts/preprocessing_pipeline/scaler_pipeline"

  steps:
    - name: "unit_cleanup"
      enabled: true
    - name: "data_preparation"
      enabled: true
    - name: "ordinal_encoding"
      enabled: true
    - name: "onehot_encoding"
      enabled: true
    - name: "standard_scaling"
      enabled: true

# ---------------------------------------------------------
# MODEL EVALUATION TABLES
# ---------------------------------------------------------
tables:
  evaluation_log: "workspace.ml_credit_risk.model_evaluation_log"
  registration_log: "workspace.ml_credit_risk.model_registration_log"
  best_model_metadata: "workspace.ml_credit_risk.best_model_metadata"
  uat_results: "workspace.ml_credit_risk.uat_inference_results"
  feature_importance: "workspace.ml_credit_risk.feature_importance_log"
  model_comparison: "workspace.ml_credit_risk.model_comparison_summary"

# ---------------------------------------------------------
# WORKFLOW CONFIGURATION
# ---------------------------------------------------------
workflow:
  training:
    enabled: true
    log_to_mlflow: true
    save_artifacts: true
    use_preprocessed_data: false

  evaluation:
    enabled: true
    save_to_table: true
    generate_plots: true
    compare_with_previous: true

  registration:
    strategy: "always"
    smart_rules:
      skip_duplicates: true
      respect_thresholds: false
      track_all_experiments: true

    register_components:
      model: true
      preprocessor: false
      config: true
      plots: true
      feature_names: true

  best_model_selection:
    enabled: false

# ---------------------------------------------------------
# UAT CONFIGURATION
# ---------------------------------------------------------
uat:
  enabled: true
  classification_thresholds:
    min_accuracy: 0.70
    min_f1: 0.60
    min_roc_auc: 0.75
    min_recall: 0.75
    max_inference_time_ms: 500
 
  test_data:
    use_holdout: true
    sample_size: 1000

  approval:
    manual_review_required: false
    notify_on_failure: true

# ---------------------------------------------------------
# LOGGING & MONITORING
# ---------------------------------------------------------
logging:
  level: "INFO"
  log_to_table: true
  log_to_file: false

  track_artifacts:
    confusion_matrix: true
    roc_curve: true
    feature_importance: true
    learning_curves: false
    residual_plots: false

# ---------------------------------------------------------
# SERVING ENDPOINT CONFIGURATION
# ---------------------------------------------------------
serving:
  workload_size: "Small"
  workload_type: "CPU"
  scale_to_zero_enabled: true
  min_provisioned_throughput: 0
  max_provisioned_throughput: 0
  deployment_timeout: 1800
  status_check_interval: 15

  # ðŸ”¥ ENDPOINT NAME DYNAMIC RULE (USED BY CREATE SERVING SCRIPT)
  endpoint_name_format: "{base_name}-{model_type}-prod"

  environment_vars:
    ENVIRONMENT: "production"
    LOG_LEVEL: "info"

# ---------------------------------------------------------
# DEPLOYMENT ALIASES
# ---------------------------------------------------------
aliases:
  staging: "Staging"
  production: "Production"
  best: "Best"
  baseline: "Baseline"

# ---------------------------------------------------------
# NOTIFICATION SETTINGS
# ---------------------------------------------------------
notifications:
  enabled: false
  triggers:
    - event: "model_registered"
      enabled: true
    - event: "new_champion"
      enabled: true
    - event: "uat_failure"
      enabled: true
    - event: "training_failure"
      enabled: true

  channels:
    email: []
    slack: []
    teams: []

# ---------------------------------------------------------
# EXPERIMENT COMPARISON
# ---------------------------------------------------------
comparison:
  enabled: true
  comparison_scope: "model_type"
  recent_n: 10
  compare_metrics:
    - test_f1
    - test_accuracy
    - test_roc_auc
    - test_recall
    - train_time
    - inference_time

  generate_artifacts:
    comparison_table: true
    performance_plot: true
    rank_models: true

# ---------------------------------------------------------
# ADVANCED SETTINGS
# ---------------------------------------------------------
advanced:
  parallel:
    enabled: false
    max_workers: 4

  checkpointing:
    enabled: true
    checkpoint_dir: "/dbfs/ml/checkpoints"

  explainability:
    enabled: false
    methods: ["shap", "lime"]

  monitoring:
    enabled: false
    drift_detection: false
    performance_tracking: true

# ---------------------------------------------------------
# INFERENCE CONFIGURATION (ðŸ”¥ NEW)
# ---------------------------------------------------------
inference:
  enabled: true
  batch_size: 100
  output_table_format: "{catalog}.{schema}.prod_inference_{model_type}"